# create a 4D volume

python3
import nibabel
data = {'~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-503_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-506_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-507_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-508_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-510_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-511_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-512_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-513_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-514_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-515_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-516_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-517_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-518_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-519_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-520_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-521_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-523_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-524_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-525_ses-B_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-526_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-529_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-531_ses-A_T1w.nii'
    '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/smwc1sub-533_ses-A_T1w.nii'}

4Dvolume = nibabel.funcs.concat_images(MRI)
nibabel.save(4Dvolume, '~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/4Dvolume.nii')

exit()

# for information on how to install the TFCE mediation package see https://github.com/trislett/TFCE_mediation/wiki/Install-TFCE_mediation

# create a csv file called 'stri_plac.csv' with "plac_striatum" colum from data.csv for the 26 subjects and keep in the same folder
# do the same for Glx 'Glx.csv' and ICV 'covariates.csv'

# TFCE mediation analysis
# load data
tfce_mediation step0-voxel -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/preprocessed_gray_matter_maps/4Dvolume.nii ~/Downloads/PFC_GrayMatter_DA-Glx/data/masks/mask_MNIspace.nii

# regress out covariates
tm_tools regressor-tools -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates.csv -r -s
tm_tools regressor-tools -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates.csv -r -s

# Glx = independent and dopamine = dependent variable
# mediation with independent neuroimaging data ##1
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m I
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m I -p 8
cd output_med_I
tfce_mediation voxel-calculate-fwep -i  SobelZ_I_TFCE.nii.gz  perm_SobelZ/perm_Zstat_I_TFCE_maxVoxel.csv

# mediation with mediating neuroimaging data ##2
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m M
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m M -p 8
cd output_med_M
tfce_mediation voxel-calculate-fwep -i  SobelZ_M_TFCE.nii.gz  perm_SobelZ/perm_Zstat_M_TFCE_maxVoxel.csv

# mediation with dependent neuroimaging data ##3
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m Y
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m Y -p 8
cd output_med_Y
tfce_mediation voxel-calculate-fwep -i  SobelZ_Y_TFCE.nii.gz  perm_SobelZ/perm_Zstat_Y_TFCE_maxVoxel.csv

# Glx = dependent and dopamine = independent variable
# mediation with independent neuroimaging data ##4
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m I
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m I -p 8
cd output_med_I
tfce_mediation voxel-calculate-fwep -i  SobelZ_I_TFCE.nii.gz  perm_SobelZ/perm_Zstat_I_TFCE_maxVoxel.csv

# mediation with mediating neuroimaging data ##5
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m M
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m M -p 8
cd output_med_M
tfce_mediation voxel-calculate-fwep -i  SobelZ_M_TFCE.nii.gz  perm_SobelZ/perm_Zstat_M_TFCE_maxVoxel.csv

# mediation with mediating neuroimaging data ##6
cd
tfce_mediation step1-voxel-mediation -i ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/stri_plac_resids.csv ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/Glx_resids.csv -c ~/Downloads/PFC_GrayMatter_DA-Glx/data/variables/covariates_std_dm.csv -m Y
tfce_mediation step2-randomise-parallel --voxel -n 10000 -m Y -p 8
cd output_med_Y
tfce_mediation voxel-calculate-fwep -i  SobelZ_Y_TFCE.nii.gz  perm_SobelZ/perm_Zstat_Y_TFCE_maxVoxel.csv

# Repeat these analyses using dopamine release and the 23 concerned subjects